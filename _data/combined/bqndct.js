/*BEGIN header */

/*BEGIN admin/themes/default/js/common.js */
jQuery.fn.fontCheckbox=function(){this.find('input[type=checkbox]').each(function(){if(!jQuery(this).is(':checked')){jQuery(this).prev().toggleClass('icon-check icon-check-empty');}});this.find('input[type=checkbox]').on('change',function(){jQuery(this).prev().removeClass();if(!jQuery(this).is(':checked')){jQuery(this).prev().addClass('icon-check-empty');}
else{jQuery(this).prev().addClass('icon-check');}});this.find('input[type=radio]').each(function(){if(!jQuery(this).is(':checked')){jQuery(this).prev().toggleClass('icon-dot-circled icon-circle-empty');}
else{jQuery(this).closest('label').addClass('selected');}});this.find('input[type=radio]').on('change',function(){jQuery('.font-checkbox input[type=radio][name="'+jQuery(this).attr('name')+'"]').each(function(){jQuery(this).prev().removeClass();jQuery(this).closest('label').removeClass('selected');if(!jQuery(this).is(':checked')){jQuery(this).prev().addClass('icon-circle-empty');}
else{jQuery(this).prev().addClass('icon-dot-circled');jQuery(this).closest('label').addClass('selected');}})});};jQuery('.font-checkbox').fontCheckbox();function array_delete(arr,item){var i=arr.indexOf(item);if(i!=-1)arr.splice(i,1);}
function str_repeat(i,m){for(var o=[];m>0;o[--m]=i);return o.join('');}
if(!Array.prototype.indexOf){Array.prototype.indexOf=function(elt){var len=this.length;var from=Number(arguments[1])||0;from=(from<0)?Math.ceil(from):Math.floor(from);if(from<0)
from+=len;for(;from<len;from++){if(from in this&&this[from]===elt)
return from;}
return-1;};}
function getRandomInt(min,max){min=Math.ceil(min);max=Math.floor(max);return Math.floor(Math.random()*(max-min))+min;}
function sprintf(){var i=0,a,f=arguments[i++],o=[],m,p,c,x,s='';while(f){if(m=/^[^\x25]+/.exec(f)){o.push(m[0]);}
else if(m=/^\x25{2}/.exec(f)){o.push('%');}
else if(m=/^\x25(?:(\d+)\$)?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fosuxX])/.exec(f)){if(((a=arguments[m[1]||i++])==null)||(a==undefined)){throw('Too few arguments.');}
if(/[^s]/.test(m[7])&&(typeof(a)!='number')){throw('Expecting number but found '+typeof(a));}
switch(m[7]){case'b':a=a.toString(2);break;case'c':a=String.fromCharCode(a);break;case'd':a=parseInt(a);break;case'e':a=m[6]?a.toExponential(m[6]):a.toExponential();break;case'f':a=m[6]?parseFloat(a).toFixed(m[6]):parseFloat(a);break;case'o':a=a.toString(8);break;case's':a=((a=String(a))&&m[6]?a.substring(0,m[6]):a);break;case'u':a=Math.abs(a);break;case'x':a=a.toString(16);break;case'X':a=a.toString(16).toUpperCase();break;}
a=(/[def]/.test(m[7])&&m[2]&&a>=0?'+'+a:a);c=m[3]?m[3]=='0'?'0':m[3].charAt(1):' ';x=m[5]-String(a).length-s.length;p=m[5]?str_repeat(c,x):'';o.push(s+(m[4]?a+p:p+a));}
else{throw('Huh ?!');}
f=f.substring(m[0].length);}
return o.join('');}
$('.search-cancel').on('click',function(){$('.search-input').val('');$('.search-input').trigger("input");})
$('.search-input').on('input',function(){if($('.search-input').val()==''){$('.search-cancel').hide();}else{$('.search-cancel').show();}})
class TemporaryState{constructor(){this.attrChanges=[];this.classChanges=[];this.htmlChanges=[];}
changeAttribute(obj,attr,tempVal){for(let i=0;i<obj.length;i++){this.attrChanges.push({object:$(obj[i]),attribute:attr,value:$(obj[i]).attr(attr)})}
obj.attr(attr,tempVal)}
changeClass(obj,st,tempclass){for(let i=0;i<obj.length;i++){if(!($(obj[i]).hasClass(tempclass)&&st)){this.classChanges.push({object:$(obj[i]),state:!st,class:tempclass})
if(st)
$(obj[i]).addClass(tempclass)
else
$(obj[i]).removeClass(tempclass)}}}
addClass(obj,tempclass){this.changeClass(obj,true,tempclass);}
removeClass(obj,tempclass){this.changeClass(obj,false,tempclass);}
changeHTML(obj,temphtml){for(let i=0;i<obj.length;i++){this.htmlChanges.push({object:$(obj[i]),html:$(obj[i]).html()})}
obj.html(temphtml);}
reverse(){this.attrChanges.forEach(function(change){if(change.value==undefined){change.object.removeAttr(change.attribute);}else{change.object.attr(change.attribute,change.value)}})
this.classChanges.forEach(function(change){if(change.state)
change.object.addClass(change.class)
else
change.object.removeClass(change.class)})
this.htmlChanges.forEach(function(change){change.object.html(change.html);})
this.attrChanges=[];this.classChanges=[];this.htmlChanges=[];}}
const jConfirm_alert_options={icon:'icon-ok',titleClass:"jconfirmAlert",theme:"modern",closeIcon:true,draggable:false,animation:"zoom",boxWidth:'20%',useBootstrap:false,backgroundDismiss:true,animateFromElement:false,typeAnimated:false,}
const jConfirm_confirm_options={draggable:false,titleClass:"jconfirmDeleteConfirm",theme:"modern",animation:"zoom",boxWidth:'40%',useBootstrap:false,type:'red',animateFromElement:false,backgroundDismiss:true,typeAnimated:false,}
const jConfirm_warning_options={icon:"icon-attention",draggable:false,titleClass:"jconfirmWarning jconfirmAlert",theme:"modern",type:'orange',closeIcon:true,draggable:false,animation:"zoom",boxWidth:'20%',useBootstrap:false,backgroundDismiss:true,animateFromElement:false,typeAnimated:false,}
const jConfirm_confirm_with_content_options={draggable:false,theme:"modern",animation:"zoom",boxWidth:'40%',useBootstrap:false,type:'red',animateFromElement:false,backgroundDismiss:true,typeAnimated:false,}
jQuery.fn.pwg_jconfirm_follow_href=function({alert_title="TITLE",alert_confirm="CONFIRM",alert_cancel="CANCEL",alert_content=""}={}){let button_href=$(this).attr('href');const options=alert_content===""?jConfirm_confirm_options:jConfirm_confirm_with_content_options
$(this).click(function(){$.confirm({content:alert_content,title:alert_title,buttons:{confirm:{text:alert_confirm,btnClass:'btn-red',action:function(){window.location.href=button_href;}},cancel:{text:alert_cancel}},...options});return(false);});};

/*BEGIN admin/themes/default/js/tags.js */
var dataTags=$('.tag-container').data('tags');$('#select-100').prop('checked',true)
$('.tag-warning p a').on('click',()=>{let url=$('.tag-warning p a').data('url');let tags=orphan_tag_names;let str_orphans=str_orphan_tags.replace('%s1',tags.length).replace('%s2',tags.join(', '));$.confirm({content:str_orphans,title:str_delete_orphan_tags,draggable:false,theme:"modern",animation:"zoom",boxWidth:'30%',useBootstrap:false,type:'red',animateFromElement:false,backgroundDismiss:true,typeAnimated:false,buttons:{delete:{text:str_delete_them,btnClass:'btn-red',action:function(){window.location.href=url.replace(/amp;/g,'');}},keep:{text:str_keep_them,action:function(){$('.tag-warning').hide();}}}})})
function createTagBox(id,name,url_name,count){let u_edit='admin.php?page=batch_manager&filter=tag-'+id;let u_view='index.php?/tags/'+id+'-'+url_name;let html=$('.tag-template').html().replace(/%name%/g,unescape(name)).replace('%U_VIEW%',u_view).replace('%U_EDIT%',u_edit)
newTag=$('<div class="tag-box" data-id='+id+' data-selected="0">'+html+'</div>');if($("#toggleSelectionMode").is(":checked")){newTag.addClass('selection');newTag.find(".in-selection-mode").show();}
if(count>0){newTag.find('.dropdown-option.view, .dropdown-option.manage').css('display','block');newTag.find('.tag-dropdown-header i').html(str_number_photos.replace('%d',count));}else{newTag.find('.tag-dropdown-header i').html(str_no_photos);}
return newTag;}
function recycleTagBox(tagBox,id,name,url_name,count){tagBox=tagBox.first();tagBox.attr('data-id',id);tagBox.find('.tag-name, .tag-dropdown-header b').html(name);tagBox.find('.tag-name-editable').val(name)
tagBox.attr('data-selected',0)
let u_edit='admin.php?page=batch_manager&filter=tag-'+id;let u_view='index.php?/tags/'+id+'-'+url_name;tagBox.find('.dropdown-option.view').attr('href',u_view);tagBox.find('.dropdown-option.manage').attr('href',u_edit);if(count>0){tagBox.find('.dropdown-option.view, .dropdown-option.manage').css('display','block');tagBox.find('.tag-dropdown-header i').html(str_number_photos.replace('%d',count));}else{tagBox.find('.tag-dropdown-header i').html(str_no_photos);}}
function updateBadge(){$('.badge-number').html(dataTags.length);if(dataTags.length==0){$(".tag-header #add-tag .add-tag-label").addClass("highlight");}else{$(".tag-header #add-tag .add-tag-label").removeClass("highlight");}}
$('.add-tag-container').on('click',function(){$('#add-tag').addClass('input-mode');$('#add-tag-input').focus();$('.tag-info').hide();})
$('#add-tag .icon-cancel-circled').on('click',function(){$('#add-tag').removeClass('input-mode');$('.tag-info').hide();})
$('.tag-box').each(function(){setupTagbox($(this))})
$(".TagSubmit").on('click',function(){$('.TagSubmit').hide();$('.TagLoading').show();renameTag($(".RenameTagPopInContainer").find(".tag-property-input").attr("id"),$(".RenameTagPopInContainer").find(".tag-property-input").val()).then(()=>{$('.TagSubmit').show();$('.TagLoading').hide();rename_tag_close();}).catch((message)=>{$('.TagSubmit').show();$('.TagLoading').hide();console.error(message)})});$('#add-tag').submit(function(e){e.preventDefault();if($('#add-tag-input').val()!=""){loadState=new TemporaryState();loadState.removeClass($('#add-tag .icon-validate'),'icon-plus');loadState.changeHTML($('#add-tag .icon-validate'),"<i class='icon-spin6 animate-spin'> </i>")
loadState.changeAttribute($('#add-tag .icon-validate'),'style','pointer-event:none')
addTag($('#add-tag-input').val()).then(function(){showMessage(str_tag_created.replace('%s',$('#add-tag-input').val()));$('#add-tag-input').val("");$('#add-tag').removeClass('input-mode');$("#search-tag .search-input").trigger("input");loadState.reverse();}).catch(message=>{loadState.reverse();showError(message)})}});$('#add-tag .icon-validate').on('click',function(){if($('#add-tag').hasClass('input-mode')){$('#add-tag').submit();}})
function addTag(name){return new Promise((resolve,reject)=>{jQuery.ajax({url:"ws.php?format=json&method=pwg.tags.add",type:"POST",data:{name:name},success:function(raw_data){data=jQuery.parseJSON(raw_data);if(data.stat==="ok"){newTag=createTagBox(data.result.id,data.result.name,data.result.url_name,0);$('.tag-container').prepend(newTag);setupTagbox(newTag);updateSearchInfo();dataTags.unshift({name:data.result.name,id:data.result.id,url_name:data.result.url_name});updateBadge();resolve();}else{reject(str_already_exist.replace('%s',name));}},error:function(err){reject(err);}})})}
function setupTagbox(tagBox){tagBox.find('.showOptions').on('click',function(){tagBox.find(".tag-dropdown-block").css('display','grid');})
$(document).mouseup(function(e){e.stopPropagation();let option_is_clicked=false
tagBox.find('.dropdown-option').each(function(){if(!($(this).has(e.target).length===0)){option_is_clicked=true;}})
if(!option_is_clicked){tagBox.find(".tag-dropdown-block").hide();}});tagBox.on('click',function(){if($('.tag-container').hasClass('selection')){if(tagBox.attr('data-selected')=='1'){tagBox.attr('data-selected','0');removeSelectedItem(tagBox.attr('data-id'));}else{tagBox.attr('data-selected','1');addSelectedItem(tagBox.attr('data-id'));}
updateSelectionContent();}})
tagBox.find('.dropdown-option.edit').on('click',function(){set_up_popin(tagBox.data('id'),tagBox.find('.tag-name').html());rename_tag_open()})
tagBox.find('.dropdown-option.delete').on('click',function(){$.confirm({title:str_delete.replace("%s",tagBox.find('.tag-name').html()),buttons:{confirm:{text:str_yes_delete_confirmation,btnClass:'btn-red',action:function(){removeTag(tagBox.data('id'),tagBox.find('.tag-name').html());},},cancel:{text:str_no_delete_confirmation}},...jConfirm_confirm_options})})
tagBox.find('.dropdown-option.duplicate').on('click',function(){duplicateTag(tagBox.data('id'),tagBox.find('.tag-name').html()).then((data)=>{showMessage(str_tag_created.replace('%s',data.result.name))})})}
function set_up_popin(id,tagName){$(".RenameTagPopInContainer").find(".tag-property-input").attr("id",id);$(".AddIconTitle span").html(str_tag_rename.replace("%s",tagName))
$(".ClosePopIn, .TagCancel").on('click',function(){rename_tag_close()});$(".TagSubmit").html(str_yes_rename_confirmation);$(".RenameTagPopInContainer").find(".tag-property-input").val(tagName);}
function rename_tag_close(){$("#RenameTag").fadeOut();}
function rename_tag_open(){$("#RenameTag").fadeIn();$(".tag-property-input").first().focus();}
function removeTag(id,name){$.alert({title:str_tag_deleted.replace("%s",name),content:function(){return jQuery.ajax({url:"ws.php?format=json&method=pwg.tags.delete",type:"POST",data:{tag_id:id,pwg_token:pwg_token},success:function(raw_data){data=jQuery.parseJSON(raw_data);if(data.stat==="ok"){$('.tag-box[data-id='+id+']').remove();dataTags=dataTags.filter((tag)=>tag.id!=id);showMessage(str_tag_deleted.replace('%s',name));updateBadge();updateSearchInfo();updatePaginationMenu();}else{showError('A problem has occured')}}})},...jConfirm_alert_options});}
function renameTag(id,new_name){return new Promise((resolve,reject)=>{jQuery.ajax({url:"ws.php?format=json&method=pwg.tags.rename",type:"POST",data:{tag_id:id,new_name:new_name,pwg_token:pwg_token},success:function(raw_data){data=jQuery.parseJSON(raw_data);console.log(data);if(data.stat==="ok"){$('.tag-box[data-id='+id+'] p, .tag-box[data-id='+id+'] .tag-dropdown-header b').html(data.result.name);$('.tag-box[data-id='+id+'] .tag-name-editable').attr('value',data.result.name);let u_view='index.php?/tags/'+id+'-'+data.result.url_name;$('.dropdown-option.view').attr('href',u_view);index=dataTags.findIndex((tag)=>tag.id==id);dataTags[index].name=data.result.name;dataTags[index].url_name=data.result.url_name;resolve(data);}else{reject(str_already_exist.replace('%s',new_name))}},error:function(XMLHttpRequest){reject(XMLHttpRequest.statusText);}})})}
function duplicateTag(id,name){return new Promise((resolve,reject)=>{copy_name=name+str_copy;let name_exist=function(name){exist=false;$(".tag-box .tag-name").each(function(){if($(this).html()===name)
exist=true})
return exist;}
let i=1;while(name_exist(copy_name)){copy_name=name+str_other_copy.replace("%s",i++)}
jQuery.ajax({url:"ws.php?format=json&method=pwg.tags.duplicate",type:"POST",data:{tag_id:id,copy_name:copy_name,pwg_token:pwg_token},success:function(raw_data){data=jQuery.parseJSON(raw_data);if(data.stat==="ok"){newTag=createTagBox(data.result.id,data.result.name,data.result.url_name,data.result.count);newTag.insertAfter($('.tag-box[data-id='+id+']'));setupTagbox(newTag);index=dataTags.findIndex((tag)=>tag.id==id);dataTags.splice(index+1,0,{name:data.result.name,id:data.result.id,url_name:data.result.url_name,counter:data.result.count});updateBadge();updateSearchInfo();resolve(data);}},error:function(XMLHttpRequest){reject(XMLHttpRequest.statusText);}})})}
var selected=[];maxItemDisplayed=5;$("#toggleSelectionMode").attr("checked",false)
$("#toggleSelectionMode").click(function(){selectionMode($(this).is(":checked"))
$('.tag-info').hide()});function selectionMode(isSelection){if(isSelection){$(".in-selection-mode").addClass('show');$(".not-in-selection-mode").addClass('hide');$(".tag-container").addClass("selection");$(".tag-box").removeClass('edit-name');}else{$(".in-selection-mode").removeClass('show');$(".not-in-selection-mode").removeClass('hide');$(".tag-container").removeClass("selection");$(".tag-box").attr("data-selected",'0');$('.tag-select-message').slideUp();clearSelection();}}
function clearSelection(){selected=[];$('.selection-mode-tag .tag-list').html('');$('.selection-other-tags').hide();updateSelectionContent();}
function addSelectedItem(id){if(!selected.includes(id)){selected.push(id);if(selected.length>maxItemDisplayed){$('.selection-other-tags').show();let numberDisplayed=$('.selection-mode-tag .tag-list div').length;$('.selection-other-tags').html(str_and_others_tags.replace('%s',selected.length-numberDisplayed))}else{$('.selection-other-tags').hide();if(dataTags.findIndex(tag=>tag.id==id)>-1){createSelectionItem(id,dataTags.find(tag=>tag.id==id).name);}}}}
function createSelectionItem(id,name){let newItemStructure=$('<div data-id="'+id+'"><a class="icon-cancel"></a><p>'+name+'</p> </div>');$('.selection-mode-tag .tag-list').prepend(newItemStructure);$('.selection-mode-tag .tag-list div[data-id='+id+'] a').on('click',function(){removeSelectedItem(id);});}
function removeSelectedItem(id){if(selected.findIndex((tag)=>tag==id)>-1){selected=selected.filter((tag)=>{return parseInt(tag)!=parseInt(id)});$('.tag-box[data-id='+id+']').attr('data-selected','0');if($('.selection-mode-tag .tag-list div[data-id='+id+']').length!=0){$('.selection-mode-tag .tag-list div[data-id='+id+']').remove();if(selected.length>=maxItemDisplayed){let i=0;isNotCreate=true
while(i<selected.length&&isNotCreate){if($('.selection-mode-tag .tag-list div[data-id='+selected[i]+']').length==0){isNotCreate=false;indexOfTag=dataTags.findIndex(tag=>tag.id==selected[i])
createSelectionItem(selected[i],dataTags[indexOfTag].name);}
i++;}}}
let numberDisplayed=$('.selection-mode-tag .tag-list div').length;$('.selection-other-tags').html(str_and_others_tags.replace('%s',selected.length-numberDisplayed))
if(selected.length-numberDisplayed<=0){$('.selection-other-tags').hide();}
$('.tag-select-message').slideUp();}}
function updateMergeItems(){$('#MergeOptionsChoices').html('');selected.forEach(id=>{$('#MergeOptionsChoices').append($('<option value="'+id+'">'+dataTags.find((tag)=>tag.id==id).name+'</option>'))})}
mergeOption=false;function updateSelectionContent(){number=selected.length;if(number==0){mergeOption=false;$('#nothing-selected').show();$('.selection-mode-tag').hide();$('#MergeOptionsBlock').hide();}else if(number==1){mergeOption=false;$('#nothing-selected').hide();$('.selection-mode-tag').show();$('#MergeOptionsBlock').hide();$('#MergeSelectionMode').addClass('unavailable');}else if(number>1){$('#nothing-selected').hide();$('#MergeSelectionMode').removeClass('unavailable');if(mergeOption){$('#MergeOptionsBlock').show();$('.selection-mode-tag').hide();updateMergeItems();}else{$('#MergeOptionsBlock').hide();$('.selection-mode-tag').show();}}}
$('#MergeSelectionMode').on('click',function(){mergeOption=true;updateSelectionContent();});$('#CancelMerge').on('click',function(){mergeOption=false;updateSelectionContent()});$('#selectAll').on('click',function(){selectAll(tagToDisplay())
updateSelectionContent();if(selected.length<dataTags.length){showSelectMessage(str_selection_done.replace('%d',$('.tag-box').length),str_select_all_tag.replace('%d',dataTags.length),function(){$('.tag-select-message a').html("");$('.tag-select-message div').html("<i class='icon-spin6 animate-spin'> </i>");setTimeout(()=>{selectAll(dataTags).then(()=>{updateSelectionContent();showSelectMessage(str_tag_selected.replace(/%d/g,selected.length),str_clear_selection,function(){selectNone();$('.tag-select-message').slideUp();})})},5);});}});function selectAll(data){promises=[];data.forEach((tag)=>{promises.push(new Promise((res,rej)=>{$('.tag-box[data-id='+tag.id+']').attr('data-selected',1);addSelectedItem(tag.id);res();}))})
return Promise.all(promises);}
function showSelectMessage(str1,str2,callback){if(!$('.tag-select-message').is(':visible')){$('.tag-select-message').slideDown({start:function(){$(this).css({display:"flex"})}});}
$('.tag-select-message div').html(str1)
$('.tag-select-message a').html(str2);$('.tag-select-message a').off('click');$('.tag-select-message a').on('click',callback);}
$('#selectNone').on('click',function(){$('.tag-select-message').slideUp();selectNone();});function selectNone(){$('.tag-box').attr('data-selected','0');clearSelection();}
$('#selectInvert').on('click',function(){$('.tag-select-message').slideUp();selectInvert(tagToDisplay());});function selectInvert(data){data.forEach((tag)=>{tagBox=$('.tag-box[data-id='+tag.id+']');if(tagBox.attr('data-selected')==1){tagBox.attr('data-selected','0');removeSelectedItem(tag.id)}else{tagBox.attr('data-selected','1');addSelectedItem(tag.id)}})
updateSelectionContent();}
$('#DeleteSelectionMode').on('click',function(){let names=[];selected.forEach(function(id){names.push(dataTags.find((tag)=>tag.id==id).name);})
$.confirm({title:str_delete_tags.replace("%s",tagListToString(names)),buttons:{confirm:{text:str_yes_delete_confirmation,btnClass:'btn-red',action:function(){removeSelectedTags();}},cancel:{text:str_no_delete_confirmation}},...jConfirm_confirm_options});})
function removeSelectedTags(){let names=[];selected.forEach(function(id){names.push(dataTags.find((tag)=>tag.id==id).name);})
$.alert({title:str_tags_deleted.replace("%s",tagListToString(names)),content:function(){return jQuery.ajax({url:"ws.php?format=json&method=pwg.tags.delete",type:"POST",data:{'pwg_token':pwg_token,'tag_id':selected},success:function(raw_data){raw_data=raw_data.slice(raw_data.search('{'));if(JSON.parse(raw_data).stat='ok'){selected.forEach(function(id){$('.tag-box[data-id='+id+']').remove();})
dataTags=dataTags.filter((tag)=>!selected.includes(tag.id))
clearSelection();updatePaginationMenu();updateBadge();updateSearchInfo();}else{return raw_data;}},error:function(message){return message;}})},...jConfirm_alert_options});}
$('.ConfirmMergeButton').on('click',()=>{dest_id=$('#MergeOptionsChoices').val();mergeGroups(dest_id,selected)})
function mergeGroups(destination_id,merge_ids){destination_name=$('.tag-box[data-id='+destination_id+'] .tag-name').html();merge_name=[];merge_ids.forEach((id)=>{merge_name.push($('.tag-box[data-id='+id+'] .tag-name').html());})
str_message=str_merged_into.replace('%s1',tagListToString(merge_name)).replace('%s2',destination_name)
$.alert({title:str_message,content:function(){return jQuery.ajax({url:"ws.php?format=json&method=pwg.tags.merge",type:"POST",data:{'pwg_token':pwg_token,'destination_tag_id':destination_id,'merge_tag_id':merge_ids},success:function(raw_data){raw_data=raw_data.slice(raw_data.search('{'));data=jQuery.parseJSON(raw_data);if(data.stat==="ok"){data.result.deleted_tag.forEach((id)=>{if(data.result.destination_tag!=id){$('.tag-box[data-id='+id+']').remove();dataTags=dataTags.filter((tag)=>id!=tag.id);}})
if(data.result.images_in_merged_tag.length>0){tagBox=$('.tag-box[data-id='+data.result.destination_tag+']')
tagBox.find('.dropdown-option.view,'+'.dropdown-option.manage,'+'.tag-dropdown-header i').show();$('.tag-dropdown-header i').html(str_number_photos.replace('%d',data.result.images_in_merged_tag.length));index=dataTags.findIndex((tag)=>tag.id==data.result.destination_tag);dataTags[index].counter=data.result.images_in_merged_tag.length;}
$(".tag-box").attr("data-selected",'0');clearSelection();updatePaginationMenu();updateBadge()
updateSearchInfo()}else{return raw_data;}}})},...jConfirm_alert_options});}
function tagListToString(list){if(list.length>5){return list.slice(0,5).join(', ')
+' '
+str_and_others_tags.replace('%s',list.length-5);}else{return list.join(', ');}}
var maxShown=100;var searchTimeOut;var delaySearchInput=300;$("#search-tag .search-input").on("input",function(){actualPage=1;clearTimeout(searchTimeOut);searchTimeOut=setTimeout(()=>{updatePaginationMenu();if(dataTags.filter(isDataSearched).length==0){$('.emptyResearch').show();}else{$('.emptyResearch').hide();}},delaySearchInput);});function isSearched(tagBox,stringSearch){let name=tagBox.find("p").text().toLowerCase();if(name.startsWith(stringSearch.toLowerCase())){return true;}else{return false;}}
function isDataSearched(tagObj){let name=tagObj.name.toLowerCase();let stringSearch=$("#search-tag .search-input").val();if(name.includes(stringSearch.toLowerCase())){return true;}else{return false;}}
function showError(message){$('.tag-error p').html(message);$('.tag-error').attr('title',message)
$('.tag-info').hide()
$('.tag-error').css('display','flex');}
function showMessage(message){$('.tag-message p').html(message);$('.tag-message').attr('title',message)
$('.tag-info').hide()
$('.tag-message').css('display','flex');}
var per_page=$('.tag-container').data('per_page');var pageItem='<a data-page="%d">%d</a>';var pageEllipsis='<span>...</span>';var promisePending=false;var delay=100;var updateAsk=false;var actualPage=1;function askUpdatePage(){if(!promisePending){promisePending=true;updatePage().then(promiseFinish);}else{updateAsk=true;}}
function promiseFinish(){promisePending=false;if(updateAsk){updateAsk=false;askUpdatePage();}}
function updatePaginationMenu(){$('.pagination-item-container').html('');actualPage=Math.min(actualPage,getNumberPages());if(getNumberPages()>1){$('.pagination-container').show();createPaginationMenu();}else{$('.pagination-container').hide();}
updateArrows();askUpdatePage();$('.tag-select-message').slideUp();}
function createPaginationMenu(){nbPage=getNumberPages();appendPaginationItem(1);if(actualPage>2){appendPaginationItem();}
if(actualPage!=1&&actualPage!=nbPage){appendPaginationItem(actualPage)}
if(actualPage<(nbPage-1)){appendPaginationItem();}
appendPaginationItem(nbPage);}
function appendPaginationItem(page=null){if(page!=null){let newTag=$(pageItem.replace(/%d/g,page))
$('.pagination-item-container').append(newTag);if(actualPage==page){newTag.addClass('actual');}
newTag.on('click',()=>{actualPage=newTag.data('page');updatePaginationMenu();})}else{$('.pagination-item-container').append($(pageEllipsis));}}
function updateArrows(){if(actualPage==1){$('.pagination-arrow.left').addClass('unavailable');}else{$('.pagination-arrow.left').removeClass('unavailable');}
if(actualPage==getNumberPages()){$('.pagination-arrow.rigth').addClass('unavailable');}else{$('.pagination-arrow.rigth').removeClass('unavailable');}}
function getNumberPages(){dataVisible=dataTags.filter(isDataSearched).length;return Math.floor((dataVisible-1)/ per_page)+1;}
function movePage(toRigth=true){$(".tag-box").removeClass("edit-name");if(toRigth){if(actualPage<getNumberPages()){actualPage++;updatePaginationMenu();}}else{if(actualPage>1){actualPage--;updatePaginationMenu();}}}
function updatePage(){return new Promise((resolve,reject)=>{newPage=actualPage;dataToDisplay=tagToDisplay();tagBoxes=$('.tag-box');$('.pageLoad').fadeIn();;$('.tag-box').animate({opacity:0},500).promise().then(()=>{let displayTags=new Promise((res,rej)=>{boxToRecycle=Math.min(dataToDisplay.length,tagBoxes.length);for(let i=0;i<boxToRecycle;i++){let tag=dataToDisplay[i];recycleTagBox($(tagBoxes[i]),tag.id,tag.name,tag.url_name,tag.counter)}
if(dataToDisplay.length<tagBoxes.length){for(let j=boxToRecycle;j<tagBoxes.length;j++){$(tagBoxes[j]).remove();}}else if(dataToDisplay.length>tagBoxes.length){for(let j=boxToRecycle;j<dataToDisplay.length;j++){let tag=dataToDisplay[j];newTag=createTagBox(tag.id,tag.name,tag.url_name,tag.counter);newTag.css('opacity',0);$('.tag-container').append(newTag);setupTagbox(newTag);}}
selected.forEach((id)=>{$('.tag-box[data-id='+id+']').attr('data-selected',1);})
res();})
displayTags.then(()=>{$('.pageLoad').fadeOut();$('.tag-box').animate({opacity:1},500);if(getNumberPages()>1){$('.tag-pagination').animate({opacity:1},500);}
updateSearchInfo();resolve()})});})}
function tagToDisplay(){return dataTags.filter(isDataSearched).slice((actualPage-1)*per_page,(actualPage)*per_page);}
$('.pagination-arrow.rigth').on('click',()=>{movePage();})
$('.pagination-arrow.left').on('click',()=>{movePage(false);})
if(getNumberPages()>1){$('.pagination-container').show();createPaginationMenu();updateArrows();}else{$('.pagination-container').hide();}
$('.pagination-per-page a').on('click',function(){per_page=parseInt($(this).html());updatePaginationMenu();$(".pagination-per-page .selected").removeClass("selected");$(this).addClass("selected");$.cookie("pwg_tags_per_page",per_page);})
function updateSearchInfo(){if($('.search-input').val()!=''){let number=dataTags.filter(isDataSearched).length;if(number>1){$('.search-info').html(str_tags_found.replace('%d',number));}else{$('.search-info').html(str_tag_found.replace('%d',number));}}else{$('.search-info').html('');}}
$(function(){function setPagination(){let test=$.cookie("pwg_tags_per_page");$(".pagination-per-page .selected").removeClass("selected");$("#"+test).trigger("click");}
setPagination()});

/*BEGIN themes/default/js/plugins/jquery-confirm.min.js */
/*!
 * jquery-confirm v3.3.4 (http://craftpip.github.io/jquery-confirm/)
 * Author: Boniface Pereira
 * Website: www.craftpip.com
 * Contact: hey@craftpip.com
 *
 * Copyright 2013-2019 jquery-confirm
 * Licensed under MIT (https://github.com/craftpip/jquery-confirm/blob/master/LICENSE)
 */
(function(factory){if(typeof define==="function"&&define.amd){define(["jquery"],factory);}else{if(typeof module==="object"&&module.exports){module.exports=function(root,jQuery){if(jQuery===undefined){if(typeof window!=="undefined"){jQuery=require("jquery");}else{jQuery=require("jquery")(root);}}factory(jQuery);return jQuery;};}else{factory(jQuery);}}}(function($){var w=window;$.fn.confirm=function(options,option2){if(typeof options==="undefined"){options={};}if(typeof options==="string"){options={content:options,title:(option2)?option2:false};}$(this).each(function(){var $this=$(this);if($this.attr("jc-attached")){console.warn("jConfirm has already been attached to this element ",$this[0]);return;}$this.on("click",function(e){e.preventDefault();var jcOption=$.extend({},options);if($this.attr("data-title")){jcOption.title=$this.attr("data-title");}if($this.attr("data-content")){jcOption.content=$this.attr("data-content");}if(typeof jcOption.buttons==="undefined"){jcOption.buttons={};}jcOption["$target"]=$this;if($this.attr("href")&&Object.keys(jcOption.buttons).length===0){var buttons=$.extend(true,{},w.jconfirm.pluginDefaults.defaultButtons,(w.jconfirm.defaults||{}).defaultButtons||{});var firstBtn=Object.keys(buttons)[0];jcOption.buttons=buttons;jcOption.buttons[firstBtn].action=function(){location.href=$this.attr("href");};}jcOption.closeIcon=false;var instance=$.confirm(jcOption);});$this.attr("jc-attached",true);});return $(this);};$.confirm=function(options,option2){if(typeof options==="undefined"){options={};}if(typeof options==="string"){options={content:options,title:(option2)?option2:false};}var putDefaultButtons=!(options.buttons===false);if(typeof options.buttons!=="object"){options.buttons={};}if(Object.keys(options.buttons).length===0&&putDefaultButtons){var buttons=$.extend(true,{},w.jconfirm.pluginDefaults.defaultButtons,(w.jconfirm.defaults||{}).defaultButtons||{});options.buttons=buttons;}return w.jconfirm(options);};$.alert=function(options,option2){if(typeof options==="undefined"){options={};}if(typeof options==="string"){options={content:options,title:(option2)?option2:false};}var putDefaultButtons=!(options.buttons===false);if(typeof options.buttons!=="object"){options.buttons={};}if(Object.keys(options.buttons).length===0&&putDefaultButtons){var buttons=$.extend(true,{},w.jconfirm.pluginDefaults.defaultButtons,(w.jconfirm.defaults||{}).defaultButtons||{});var firstBtn=Object.keys(buttons)[0];options.buttons[firstBtn]=buttons[firstBtn];}return w.jconfirm(options);};$.dialog=function(options,option2){if(typeof options==="undefined"){options={};}if(typeof options==="string"){options={content:options,title:(option2)?option2:false,closeIcon:function(){}};}options.buttons={};if(typeof options.closeIcon==="undefined"){options.closeIcon=function(){};}options.confirmKeys=[13];return w.jconfirm(options);};w.jconfirm=function(options){if(typeof options==="undefined"){options={};}var pluginOptions=$.extend(true,{},w.jconfirm.pluginDefaults);if(w.jconfirm.defaults){pluginOptions=$.extend(true,pluginOptions,w.jconfirm.defaults);}pluginOptions=$.extend(true,{},pluginOptions,options);var instance=new w.Jconfirm(pluginOptions);w.jconfirm.instances.push(instance);return instance;};w.Jconfirm=function(options){$.extend(this,options);this._init();};w.Jconfirm.prototype={_init:function(){var that=this;if(!w.jconfirm.instances.length){w.jconfirm.lastFocused=$("body").find(":focus");}this._id=Math.round(Math.random()*99999);this.contentParsed=$(document.createElement("div"));if(!this.lazyOpen){setTimeout(function(){that.open();},0);}},_buildHTML:function(){var that=this;this._parseAnimation(this.animation,"o");this._parseAnimation(this.closeAnimation,"c");this._parseBgDismissAnimation(this.backgroundDismissAnimation);this._parseColumnClass(this.columnClass);this._parseTheme(this.theme);this._parseType(this.type);var template=$(this.template);template.find(".jconfirm-box").addClass(this.animationParsed).addClass(this.backgroundDismissAnimationParsed).addClass(this.typeParsed);if(this.typeAnimated){template.find(".jconfirm-box").addClass("jconfirm-type-animated");}if(this.useBootstrap){template.find(".jc-bs3-row").addClass(this.bootstrapClasses.row);template.find(".jc-bs3-row").addClass("justify-content-md-center justify-content-sm-center justify-content-xs-center justify-content-lg-center");template.find(".jconfirm-box-container").addClass(this.columnClassParsed);if(this.containerFluid){template.find(".jc-bs3-container").addClass(this.bootstrapClasses.containerFluid);}else{template.find(".jc-bs3-container").addClass(this.bootstrapClasses.container);}}else{template.find(".jconfirm-box").css("width",this.boxWidth);}if(this.titleClass){template.find(".jconfirm-title-c").addClass(this.titleClass);}template.addClass(this.themeParsed);var ariaLabel="jconfirm-box"+this._id;template.find(".jconfirm-box").attr("aria-labelledby",ariaLabel).attr("tabindex",-1);template.find(".jconfirm-content").attr("id",ariaLabel);if(this.bgOpacity!==null){template.find(".jconfirm-bg").css("opacity",this.bgOpacity);}if(this.rtl){template.addClass("jconfirm-rtl");}this.$el=template.appendTo(this.container);this.$jconfirmBoxContainer=this.$el.find(".jconfirm-box-container");this.$jconfirmBox=this.$body=this.$el.find(".jconfirm-box");this.$jconfirmBg=this.$el.find(".jconfirm-bg");this.$title=this.$el.find(".jconfirm-title");this.$titleContainer=this.$el.find(".jconfirm-title-c");this.$content=this.$el.find("div.jconfirm-content");this.$contentPane=this.$el.find(".jconfirm-content-pane");this.$icon=this.$el.find(".jconfirm-icon-c");this.$closeIcon=this.$el.find(".jconfirm-closeIcon");this.$holder=this.$el.find(".jconfirm-holder");this.$btnc=this.$el.find(".jconfirm-buttons");this.$scrollPane=this.$el.find(".jconfirm-scrollpane");that.setStartingPoint();this._contentReady=$.Deferred();this._modalReady=$.Deferred();this.$holder.css({"padding-top":this.offsetTop,"padding-bottom":this.offsetBottom,});this.setTitle();this.setIcon();this._setButtons();this._parseContent();this.initDraggable();if(this.isAjax){this.showLoading(false);}$.when(this._contentReady,this._modalReady).then(function(){if(that.isAjaxLoading){setTimeout(function(){that.isAjaxLoading=false;that.setContent();that.setTitle();that.setIcon();setTimeout(function(){that.hideLoading(false);that._updateContentMaxHeight();},100);if(typeof that.onContentReady==="function"){that.onContentReady();}},50);}else{that._updateContentMaxHeight();that.setTitle();that.setIcon();if(typeof that.onContentReady==="function"){that.onContentReady();}}if(that.autoClose){that._startCountDown();}}).then(function(){that._watchContent();});if(this.animation==="none"){this.animationSpeed=1;this.animationBounce=1;}this.$body.css(this._getCSS(this.animationSpeed,this.animationBounce));this.$contentPane.css(this._getCSS(this.animationSpeed,1));this.$jconfirmBg.css(this._getCSS(this.animationSpeed,1));this.$jconfirmBoxContainer.css(this._getCSS(this.animationSpeed,1));},_typePrefix:"jconfirm-type-",typeParsed:"",_parseType:function(type){this.typeParsed=this._typePrefix+type;},setType:function(type){var oldClass=this.typeParsed;this._parseType(type);this.$jconfirmBox.removeClass(oldClass).addClass(this.typeParsed);},themeParsed:"",_themePrefix:"jconfirm-",setTheme:function(theme){var previous=this.theme;this.theme=theme||this.theme;this._parseTheme(this.theme);if(previous){this.$el.removeClass(previous);}this.$el.addClass(this.themeParsed);this.theme=theme;},_parseTheme:function(theme){var that=this;theme=theme.split(",");$.each(theme,function(k,a){if(a.indexOf(that._themePrefix)===-1){theme[k]=that._themePrefix+$.trim(a);}});this.themeParsed=theme.join(" ").toLowerCase();},backgroundDismissAnimationParsed:"",_bgDismissPrefix:"jconfirm-hilight-",_parseBgDismissAnimation:function(bgDismissAnimation){var animation=bgDismissAnimation.split(",");var that=this;$.each(animation,function(k,a){if(a.indexOf(that._bgDismissPrefix)===-1){animation[k]=that._bgDismissPrefix+$.trim(a);}});this.backgroundDismissAnimationParsed=animation.join(" ").toLowerCase();},animationParsed:"",closeAnimationParsed:"",_animationPrefix:"jconfirm-animation-",setAnimation:function(animation){this.animation=animation||this.animation;this._parseAnimation(this.animation,"o");},_parseAnimation:function(animation,which){which=which||"o";var animations=animation.split(",");var that=this;$.each(animations,function(k,a){if(a.indexOf(that._animationPrefix)===-1){animations[k]=that._animationPrefix+$.trim(a);}});var a_string=animations.join(" ").toLowerCase();if(which==="o"){this.animationParsed=a_string;}else{this.closeAnimationParsed=a_string;}return a_string;},setCloseAnimation:function(closeAnimation){this.closeAnimation=closeAnimation||this.closeAnimation;this._parseAnimation(this.closeAnimation,"c");},setAnimationSpeed:function(speed){this.animationSpeed=speed||this.animationSpeed;},columnClassParsed:"",setColumnClass:function(colClass){if(!this.useBootstrap){console.warn("cannot set columnClass, useBootstrap is set to false");return;}this.columnClass=colClass||this.columnClass;this._parseColumnClass(this.columnClass);this.$jconfirmBoxContainer.addClass(this.columnClassParsed);},_updateContentMaxHeight:function(){var height=$(window).height()-(this.$jconfirmBox.outerHeight()-this.$contentPane.outerHeight())-(this.offsetTop+this.offsetBottom);this.$contentPane.css({"max-height":height+"px"});},setBoxWidth:function(width){if(this.useBootstrap){console.warn("cannot set boxWidth, useBootstrap is set to true");return;}this.boxWidth=width;this.$jconfirmBox.css("width",width);},_parseColumnClass:function(colClass){colClass=colClass.toLowerCase();var p;switch(colClass){case"xl":case"xlarge":p="col-md-12";break;case"l":case"large":p="col-md-8 col-md-offset-2";break;case"m":case"medium":p="col-md-6 col-md-offset-3";break;case"s":case"small":p="col-md-4 col-md-offset-4";break;case"xs":case"xsmall":p="col-md-2 col-md-offset-5";break;default:p=colClass;}this.columnClassParsed=p;},initDraggable:function(){var that=this;var $t=this.$titleContainer;this.resetDrag();if(this.draggable){$t.on("mousedown",function(e){$t.addClass("jconfirm-hand");that.mouseX=e.clientX;that.mouseY=e.clientY;that.isDrag=true;});$(window).on("mousemove."+this._id,function(e){if(that.isDrag){that.movingX=e.clientX-that.mouseX+that.initialX;that.movingY=e.clientY-that.mouseY+that.initialY;that.setDrag();}});$(window).on("mouseup."+this._id,function(){$t.removeClass("jconfirm-hand");if(that.isDrag){that.isDrag=false;that.initialX=that.movingX;that.initialY=that.movingY;}});}},resetDrag:function(){this.isDrag=false;this.initialX=0;this.initialY=0;this.movingX=0;this.movingY=0;this.mouseX=0;this.mouseY=0;this.$jconfirmBoxContainer.css("transform","translate("+0+"px, "+0+"px)");},setDrag:function(){if(!this.draggable){return;}this.alignMiddle=false;var boxWidth=this.$jconfirmBox.outerWidth();var boxHeight=this.$jconfirmBox.outerHeight();var windowWidth=$(window).width();var windowHeight=$(window).height();var that=this;var dragUpdate=1;if(that.movingX%dragUpdate===0||that.movingY%dragUpdate===0){if(that.dragWindowBorder){var leftDistance=(windowWidth/2)-boxWidth/2;var topDistance=(windowHeight/2)-boxHeight/2;topDistance-=that.dragWindowGap;leftDistance-=that.dragWindowGap;if(leftDistance+that.movingX<0){that.movingX=-leftDistance;}else{if(leftDistance-that.movingX<0){that.movingX=leftDistance;}}if(topDistance+that.movingY<0){that.movingY=-topDistance;}else{if(topDistance-that.movingY<0){that.movingY=topDistance;}}}that.$jconfirmBoxContainer.css("transform","translate("+that.movingX+"px, "+that.movingY+"px)");}},_scrollTop:function(){if(typeof pageYOffset!=="undefined"){return pageYOffset;}else{var B=document.body;var D=document.documentElement;D=(D.clientHeight)?D:B;return D.scrollTop;}},_watchContent:function(){var that=this;if(this._timer){clearInterval(this._timer);}var prevContentHeight=0;this._timer=setInterval(function(){if(that.smoothContent){var contentHeight=that.$content.outerHeight()||0;if(contentHeight!==prevContentHeight){prevContentHeight=contentHeight;}var wh=$(window).height();var total=that.offsetTop+that.offsetBottom+that.$jconfirmBox.height()-that.$contentPane.height()+that.$content.height();if(total<wh){that.$contentPane.addClass("no-scroll");}else{that.$contentPane.removeClass("no-scroll");}}},this.watchInterval);},_overflowClass:"jconfirm-overflow",_hilightAnimating:false,highlight:function(){this.hiLightModal();},hiLightModal:function(){var that=this;if(this._hilightAnimating){return;}that.$body.addClass("hilight");var duration=parseFloat(that.$body.css("animation-duration"))||2;this._hilightAnimating=true;setTimeout(function(){that._hilightAnimating=false;that.$body.removeClass("hilight");},duration*1000);},_bindEvents:function(){var that=this;this.boxClicked=false;this.$scrollPane.click(function(e){if(!that.boxClicked){var buttonName=false;var shouldClose=false;var str;if(typeof that.backgroundDismiss==="function"){str=that.backgroundDismiss();}else{str=that.backgroundDismiss;}if(typeof str==="string"&&typeof that.buttons[str]!=="undefined"){buttonName=str;shouldClose=false;}else{if(typeof str==="undefined"||!!(str)===true){shouldClose=true;}else{shouldClose=false;}}if(buttonName){var btnResponse=that.buttons[buttonName].action.apply(that);shouldClose=(typeof btnResponse==="undefined")||!!(btnResponse);}if(shouldClose){that.close();}else{that.hiLightModal();}}that.boxClicked=false;});this.$jconfirmBox.click(function(e){that.boxClicked=true;});var isKeyDown=false;$(window).on("jcKeyDown."+that._id,function(e){if(!isKeyDown){isKeyDown=true;}});$(window).on("keyup."+that._id,function(e){if(isKeyDown){that.reactOnKey(e);isKeyDown=false;}});$(window).on("resize."+this._id,function(){that._updateContentMaxHeight();setTimeout(function(){that.resetDrag();},100);});},_cubic_bezier:"0.36, 0.55, 0.19",_getCSS:function(speed,bounce){return{"-webkit-transition-duration":speed/1000+"s","transition-duration":speed/1000+"s","-webkit-transition-timing-function":"cubic-bezier("+this._cubic_bezier+", "+bounce+")","transition-timing-function":"cubic-bezier("+this._cubic_bezier+", "+bounce+")"};},_setButtons:function(){var that=this;var total_buttons=0;if(typeof this.buttons!=="object"){this.buttons={};}$.each(this.buttons,function(key,button){total_buttons+=1;if(typeof button==="function"){that.buttons[key]=button={action:button};}that.buttons[key].text=button.text||key;that.buttons[key].btnClass=button.btnClass||"btn-default";that.buttons[key].action=button.action||function(){};that.buttons[key].keys=button.keys||[];that.buttons[key].isHidden=button.isHidden||false;that.buttons[key].isDisabled=button.isDisabled||false;$.each(that.buttons[key].keys,function(i,a){that.buttons[key].keys[i]=a.toLowerCase();});var button_element=$('<button type="button" class="btn"></button>').html(that.buttons[key].text).addClass(that.buttons[key].btnClass).prop("disabled",that.buttons[key].isDisabled).css("display",that.buttons[key].isHidden?"none":"").click(function(e){e.preventDefault();var res=that.buttons[key].action.apply(that,[that.buttons[key]]);that.onAction.apply(that,[key,that.buttons[key]]);that._stopCountDown();if(typeof res==="undefined"||res){that.close();}});that.buttons[key].el=button_element;that.buttons[key].setText=function(text){button_element.html(text);};that.buttons[key].addClass=function(className){button_element.addClass(className);};that.buttons[key].removeClass=function(className){button_element.removeClass(className);};that.buttons[key].disable=function(){that.buttons[key].isDisabled=true;button_element.prop("disabled",true);};that.buttons[key].enable=function(){that.buttons[key].isDisabled=false;button_element.prop("disabled",false);};that.buttons[key].show=function(){that.buttons[key].isHidden=false;button_element.css("display","");};that.buttons[key].hide=function(){that.buttons[key].isHidden=true;button_element.css("display","none");};that["$_"+key]=that["$$"+key]=button_element;that.$btnc.append(button_element);});if(total_buttons===0){this.$btnc.hide();}if(this.closeIcon===null&&total_buttons===0){this.closeIcon=true;}if(this.closeIcon){if(this.closeIconClass){var closeHtml='<i class="'+this.closeIconClass+'"></i>';this.$closeIcon.html(closeHtml);}this.$closeIcon.click(function(e){e.preventDefault();var buttonName=false;var shouldClose=false;var str;if(typeof that.closeIcon==="function"){str=that.closeIcon();}else{str=that.closeIcon;}if(typeof str==="string"&&typeof that.buttons[str]!=="undefined"){buttonName=str;shouldClose=false;}else{if(typeof str==="undefined"||!!(str)===true){shouldClose=true;}else{shouldClose=false;}}if(buttonName){var btnResponse=that.buttons[buttonName].action.apply(that);shouldClose=(typeof btnResponse==="undefined")||!!(btnResponse);}if(shouldClose){that.close();}});this.$closeIcon.show();}else{this.$closeIcon.hide();}},setTitle:function(string,force){force=force||false;if(typeof string!=="undefined"){if(typeof string==="string"){this.title=string;}else{if(typeof string==="function"){if(typeof string.promise==="function"){console.error("Promise was returned from title function, this is not supported.");}var response=string();if(typeof response==="string"){this.title=response;}else{this.title=false;}}else{this.title=false;}}}if(this.isAjaxLoading&&!force){return;}this.$title.html(this.title||"");this.updateTitleContainer();},setIcon:function(iconClass,force){force=force||false;if(typeof iconClass!=="undefined"){if(typeof iconClass==="string"){this.icon=iconClass;}else{if(typeof iconClass==="function"){var response=iconClass();if(typeof response==="string"){this.icon=response;}else{this.icon=false;}}else{this.icon=false;}}}if(this.isAjaxLoading&&!force){return;}this.$icon.html(this.icon?'<i class="'+this.icon+'"></i>':"");this.updateTitleContainer();},updateTitleContainer:function(){if(!this.title&&!this.icon){this.$titleContainer.hide();}else{this.$titleContainer.show();}},setContentPrepend:function(content,force){if(!content){return;}this.contentParsed.prepend(content);},setContentAppend:function(content){if(!content){return;}this.contentParsed.append(content);},setContent:function(content,force){force=!!force;var that=this;if(content){this.contentParsed.html("").append(content);}if(this.isAjaxLoading&&!force){return;}this.$content.html("");this.$content.append(this.contentParsed);setTimeout(function(){that.$body.find("input[autofocus]:visible:first").focus();},100);},loadingSpinner:false,showLoading:function(disableButtons){this.loadingSpinner=true;this.$jconfirmBox.addClass("loading");if(disableButtons){this.$btnc.find("button").prop("disabled",true);}},hideLoading:function(enableButtons){this.loadingSpinner=false;this.$jconfirmBox.removeClass("loading");if(enableButtons){this.$btnc.find("button").prop("disabled",false);}},ajaxResponse:false,contentParsed:"",isAjax:false,isAjaxLoading:false,_parseContent:function(){var that=this;var e="&nbsp;";if(typeof this.content==="function"){var res=this.content.apply(this);if(typeof res==="string"){this.content=res;}else{if(typeof res==="object"&&typeof res.always==="function"){this.isAjax=true;this.isAjaxLoading=true;res.always(function(data,status,xhr){that.ajaxResponse={data:data,status:status,xhr:xhr};that._contentReady.resolve(data,status,xhr);if(typeof that.contentLoaded==="function"){that.contentLoaded(data,status,xhr);}});this.content=e;}else{this.content=e;}}}if(typeof this.content==="string"&&this.content.substr(0,4).toLowerCase()==="url:"){this.isAjax=true;this.isAjaxLoading=true;var u=this.content.substring(4,this.content.length);$.get(u).done(function(html){that.contentParsed.html(html);}).always(function(data,status,xhr){that.ajaxResponse={data:data,status:status,xhr:xhr};that._contentReady.resolve(data,status,xhr);if(typeof that.contentLoaded==="function"){that.contentLoaded(data,status,xhr);}});}if(!this.content){this.content=e;}if(!this.isAjax){this.contentParsed.html(this.content);this.setContent();that._contentReady.resolve();}},_stopCountDown:function(){clearInterval(this.autoCloseInterval);if(this.$cd){this.$cd.remove();}},_startCountDown:function(){var that=this;var opt=this.autoClose.split("|");if(opt.length!==2){console.error("Invalid option for autoClose. example 'close|10000'");return false;}var button_key=opt[0];var time=parseInt(opt[1]);if(typeof this.buttons[button_key]==="undefined"){console.error("Invalid button key '"+button_key+"' for autoClose");return false;}var seconds=Math.ceil(time/1000);this.$cd=$('<span class="countdown"> ('+seconds+")</span>").appendTo(this["$_"+button_key]);this.autoCloseInterval=setInterval(function(){that.$cd.html(" ("+(seconds-=1)+") ");if(seconds<=0){that["$$"+button_key].trigger("click");that._stopCountDown();}},1000);},_getKey:function(key){switch(key){case 192:return"tilde";case 13:return"enter";case 16:return"shift";case 9:return"tab";case 20:return"capslock";case 17:return"ctrl";case 91:return"win";case 18:return"alt";case 27:return"esc";case 32:return"space";}var initial=String.fromCharCode(key);if(/^[A-z0-9]+$/.test(initial)){return initial.toLowerCase();}else{return false;}},reactOnKey:function(e){var that=this;var a=$(".jconfirm");if(a.eq(a.length-1)[0]!==this.$el[0]){return false;}var key=e.which;if(this.$content.find(":input").is(":focus")&&/13|32/.test(key)){return false;}var keyChar=this._getKey(key);if(keyChar==="esc"&&this.escapeKey){if(this.escapeKey===true){this.$scrollPane.trigger("click");}else{if(typeof this.escapeKey==="string"||typeof this.escapeKey==="function"){var buttonKey;if(typeof this.escapeKey==="function"){buttonKey=this.escapeKey();}else{buttonKey=this.escapeKey;}if(buttonKey){if(typeof this.buttons[buttonKey]==="undefined"){console.warn("Invalid escapeKey, no buttons found with key "+buttonKey);}else{this["$_"+buttonKey].trigger("click");}}}}}$.each(this.buttons,function(key,button){if(button.keys.indexOf(keyChar)!==-1){that["$_"+key].trigger("click");}});},setDialogCenter:function(){console.info("setDialogCenter is deprecated, dialogs are centered with CSS3 tables");},_unwatchContent:function(){clearInterval(this._timer);},close:function(onClosePayload){var that=this;if(typeof this.onClose==="function"){this.onClose(onClosePayload);}this._unwatchContent();$(window).unbind("resize."+this._id);$(window).unbind("keyup."+this._id);$(window).unbind("jcKeyDown."+this._id);if(this.draggable){$(window).unbind("mousemove."+this._id);$(window).unbind("mouseup."+this._id);this.$titleContainer.unbind("mousedown");}that.$el.removeClass(that.loadedClass);$("body").removeClass("jconfirm-no-scroll-"+that._id);that.$jconfirmBoxContainer.removeClass("jconfirm-no-transition");setTimeout(function(){that.$body.addClass(that.closeAnimationParsed);that.$jconfirmBg.addClass("jconfirm-bg-h");var closeTimer=(that.closeAnimation==="none")?1:that.animationSpeed;setTimeout(function(){that.$el.remove();var l=w.jconfirm.instances;var i=w.jconfirm.instances.length-1;for(i;i>=0;i--){if(w.jconfirm.instances[i]._id===that._id){w.jconfirm.instances.splice(i,1);}}if(!w.jconfirm.instances.length){if(that.scrollToPreviousElement&&w.jconfirm.lastFocused&&w.jconfirm.lastFocused.length&&$.contains(document,w.jconfirm.lastFocused[0])){var $lf=w.jconfirm.lastFocused;if(that.scrollToPreviousElementAnimate){var st=$(window).scrollTop();var ot=w.jconfirm.lastFocused.offset().top;var wh=$(window).height();if(!(ot>st&&ot<(st+wh))){var scrollTo=(ot-Math.round((wh/3)));$("html, body").animate({scrollTop:scrollTo},that.animationSpeed,"swing",function(){$lf.focus();});}else{$lf.focus();}}else{$lf.focus();}w.jconfirm.lastFocused=false;}}if(typeof that.onDestroy==="function"){that.onDestroy();}},closeTimer*0.4);},50);return true;},open:function(){if(this.isOpen()){return false;}this._buildHTML();this._bindEvents();this._open();return true;},setStartingPoint:function(){var el=false;if(this.animateFromElement!==true&&this.animateFromElement){el=this.animateFromElement;w.jconfirm.lastClicked=false;}else{if(w.jconfirm.lastClicked&&this.animateFromElement===true){el=w.jconfirm.lastClicked;w.jconfirm.lastClicked=false;}else{return false;}}if(!el){return false;}var offset=el.offset();var iTop=el.outerHeight()/2;var iLeft=el.outerWidth()/2;iTop-=this.$jconfirmBox.outerHeight()/2;iLeft-=this.$jconfirmBox.outerWidth()/2;var sourceTop=offset.top+iTop;sourceTop=sourceTop-this._scrollTop();var sourceLeft=offset.left+iLeft;var wh=$(window).height()/2;var ww=$(window).width()/2;var targetH=wh-this.$jconfirmBox.outerHeight()/2;var targetW=ww-this.$jconfirmBox.outerWidth()/2;sourceTop-=targetH;sourceLeft-=targetW;if(Math.abs(sourceTop)>wh||Math.abs(sourceLeft)>ww){return false;}this.$jconfirmBoxContainer.css("transform","translate("+sourceLeft+"px, "+sourceTop+"px)");},_open:function(){var that=this;if(typeof that.onOpenBefore==="function"){that.onOpenBefore();}this.$body.removeClass(this.animationParsed);this.$jconfirmBg.removeClass("jconfirm-bg-h");this.$body.focus();that.$jconfirmBoxContainer.css("transform","translate("+0+"px, "+0+"px)");setTimeout(function(){that.$body.css(that._getCSS(that.animationSpeed,1));that.$body.css({"transition-property":that.$body.css("transition-property")+", margin"});that.$jconfirmBoxContainer.addClass("jconfirm-no-transition");that._modalReady.resolve();if(typeof that.onOpen==="function"){that.onOpen();}that.$el.addClass(that.loadedClass);},this.animationSpeed);},loadedClass:"jconfirm-open",isClosed:function(){return !this.$el||this.$el.parent().length===0;},isOpen:function(){return !this.isClosed();},toggle:function(){if(!this.isOpen()){this.open();}else{this.close();}}};w.jconfirm.instances=[];w.jconfirm.lastFocused=false;w.jconfirm.pluginDefaults={template:'<div class="jconfirm"><div class="jconfirm-bg jconfirm-bg-h"></div><div class="jconfirm-scrollpane"><div class="jconfirm-row"><div class="jconfirm-cell"><div class="jconfirm-holder"><div class="jc-bs3-container"><div class="jc-bs3-row"><div class="jconfirm-box-container jconfirm-animated"><div class="jconfirm-box" role="dialog" aria-labelledby="labelled" tabindex="-1"><div class="jconfirm-closeIcon">&times;</div><div class="jconfirm-title-c"><span class="jconfirm-icon-c"></span><span class="jconfirm-title"></span></div><div class="jconfirm-content-pane"><div class="jconfirm-content"></div></div><div class="jconfirm-buttons"></div><div class="jconfirm-clear"></div></div></div></div></div></div></div></div></div></div>',title:"Hello",titleClass:"",type:"default",typeAnimated:true,draggable:true,dragWindowGap:15,dragWindowBorder:true,animateFromElement:true,alignMiddle:true,smoothContent:true,content:"Are you sure to continue?",buttons:{},defaultButtons:{ok:{action:function(){}},close:{action:function(){}}},contentLoaded:function(){},icon:"",lazyOpen:false,bgOpacity:null,theme:"light",animation:"scale",closeAnimation:"scale",animationSpeed:400,animationBounce:1,escapeKey:true,rtl:false,container:"body",containerFluid:false,backgroundDismiss:false,backgroundDismissAnimation:"shake",autoClose:false,closeIcon:null,closeIconClass:false,watchInterval:100,columnClass:"col-md-4 col-md-offset-4 col-sm-6 col-sm-offset-3 col-xs-10 col-xs-offset-1",boxWidth:"50%",scrollToPreviousElement:true,scrollToPreviousElementAnimate:true,useBootstrap:true,offsetTop:40,offsetBottom:40,bootstrapClasses:{container:"container",containerFluid:"container-fluid",row:"row"},onContentReady:function(){},onOpenBefore:function(){},onOpen:function(){},onClose:function(){},onDestroy:function(){},onAction:function(){}};var keyDown=false;$(window).on("keydown",function(e){if(!keyDown){var $target=$(e.target);var pass=false;if($target.closest(".jconfirm-box").length){pass=true;}if(pass){$(window).trigger("jcKeyDown");}keyDown=true;}});$(window).on("keyup",function(){keyDown=false;});w.jconfirm.lastClicked=false;$(document).on("mousedown","button, a, [jc-source]",function(){w.jconfirm.lastClicked=$(this);});}));

/*BEGIN themes/default/js/jquery.cookie.js */
/*!
 * jQuery Cookie Plugin v1.4.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
(function(factory){if(typeof define==='function'&&define.amd){define(['jquery'],factory);}else if(typeof exports==='object'){factory(require('jquery'));}else{factory(jQuery);}}(function($){var pluses=/\+/g;function encode(s){return config.raw?s:encodeURIComponent(s);}
function decode(s){return config.raw?s:decodeURIComponent(s);}
function stringifyCookieValue(value){return encode(config.json?JSON.stringify(value):String(value));}
function parseCookieValue(s){if(s.indexOf('"')===0){s=s.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,'\\');}
try{s=decodeURIComponent(s.replace(pluses,' '));return config.json?JSON.parse(s):s;}catch(e){}}
function read(s,converter){var value=config.raw?s:parseCookieValue(s);return $.isFunction(converter)?converter(value):value;}
var config=$.cookie=function(key,value,options){if(value!==undefined&&!$.isFunction(value)){options=$.extend({},config.defaults,options);if(typeof options.expires==='number'){var days=options.expires,t=options.expires=new Date();t.setTime(+t+days*864e+5);}
return(document.cookie=[encode(key),'=',stringifyCookieValue(value),options.expires?'; expires='+options.expires.toUTCString():'',options.path?'; path='+options.path:'',options.domain?'; domain='+options.domain:'',options.secure?'; secure':''].join(''));}
var result=key?undefined:{};var cookies=document.cookie?document.cookie.split('; '):[];for(var i=0,l=cookies.length;i<l;i++){var parts=cookies[i].split('=');var name=decode(parts.shift());var cookie=parts.join('=');if(key&&key===name){result=read(cookie,value);break;}
if(!key&&(cookie=read(cookie))!==undefined){result[name]=cookie;}}
return result;};config.defaults={};$.removeCookie=function(key,options){if($.cookie(key)===undefined){return false;}
$.cookie(key,'',$.extend({},options,{expires:-1}));return!$.cookie(key);};}));

/*BEGIN themes/default/js/plugins/jquery.tipTip.minified.js */
/*
 * TipTip
 * Copyright 2010 Drew Wilson
 * www.drewwilson.com
 * code.drewwilson.com/entry/tiptip-jquery-plugin
 *
 * Version 1.3   -   Updated: Mar. 23, 2010
 *
 * This Plug-In will create a custom tooltip to replace the default
 * browser tooltip. It is extremely lightweight and very smart in
 * that it detects the edges of the browser window and will make sure
 * the tooltip stays within the current window size. As a result the
 * tooltip will adjust itself to be displayed above, below, to the left 
 * or to the right depending on what is necessary to stay within the
 * browser window. It is completely customizable as well via CSS.
 *
 * This TipTip jQuery plug-in is dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 */
(function($){$.fn.tipTip=function(options){var defaults={activation:"hover",keepAlive:false,maxWidth:"200px",edgeOffset:3,defaultPosition:"bottom",delay:400,fadeIn:200,fadeOut:200,attribute:"title",content:false,enter:function(){},exit:function(){}};var opts=$.extend(defaults,options);if($("#tiptip_holder").length<=0){var tiptip_holder=$('<div id="tiptip_holder" style="max-width:'+opts.maxWidth+';"></div>');var tiptip_content=$('<div id="tiptip_content"></div>');var tiptip_arrow=$('<div id="tiptip_arrow"></div>');$("body").append(tiptip_holder.html(tiptip_content).prepend(tiptip_arrow.html('<div id="tiptip_arrow_inner"></div>')))}else{var tiptip_holder=$("#tiptip_holder");var tiptip_content=$("#tiptip_content");var tiptip_arrow=$("#tiptip_arrow")}return this.each(function(){var org_elem=$(this);if(opts.content){var org_title=opts.content}else{var org_title=org_elem.attr(opts.attribute)}if(org_title!=""){if(!opts.content){org_elem.removeAttr(opts.attribute)}var timeout=false;if(opts.activation=="hover"){org_elem.hover(function(){active_tiptip()},function(){if(!opts.keepAlive){deactive_tiptip()}});if(opts.keepAlive){tiptip_holder.hover(function(){},function(){deactive_tiptip()})}}else if(opts.activation=="focus"){org_elem.focus(function(){active_tiptip()}).blur(function(){deactive_tiptip()})}else if(opts.activation=="click"){org_elem.click(function(){active_tiptip();return false}).hover(function(){},function(){if(!opts.keepAlive){deactive_tiptip()}});if(opts.keepAlive){tiptip_holder.hover(function(){},function(){deactive_tiptip()})}}function active_tiptip(){opts.enter.call(this);tiptip_content.html(org_title);tiptip_holder.hide().removeAttr("class").css("margin","0").css("max-width",opts.maxWidth);tiptip_arrow.removeAttr("style");var top=parseInt(org_elem.offset()['top']);var left=parseInt(org_elem.offset()['left']);var org_width=parseInt(org_elem.outerWidth());var org_height=parseInt(org_elem.outerHeight());var tip_w=tiptip_holder.outerWidth();var tip_h=tiptip_holder.outerHeight();var w_compare=Math.round((org_width-tip_w)/2);var h_compare=Math.round((org_height-tip_h)/2);var marg_left=Math.round(left+w_compare);var marg_top=Math.round(top+org_height+opts.edgeOffset);var t_class="";var arrow_top="";var arrow_left=Math.round(tip_w-12)/2;if(opts.defaultPosition=="bottom"){t_class="_bottom"}else if(opts.defaultPosition=="top"){t_class="_top"}else if(opts.defaultPosition=="left"){t_class="_left"}else if(opts.defaultPosition=="right"){t_class="_right"}var right_compare=(w_compare+left)<parseInt($(window).scrollLeft());var left_compare=(tip_w+left)>parseInt($(window).width());if((right_compare&&w_compare<0)||(t_class=="_right"&&!left_compare)||(t_class=="_left"&&left<(tip_w+opts.edgeOffset+5))){t_class="_right";arrow_top=Math.round(tip_h-13)/2;arrow_left=-12;marg_left=Math.round(left+org_width+opts.edgeOffset);marg_top=Math.round(top+h_compare)}else if((left_compare&&w_compare<0)||(t_class=="_left"&&!right_compare)){t_class="_left";arrow_top=Math.round(tip_h-13)/2;arrow_left=Math.round(tip_w);marg_left=Math.round(left-(tip_w+opts.edgeOffset+5));marg_top=Math.round(top+h_compare)}var top_compare=(top+org_height+opts.edgeOffset+tip_h+8)>parseInt($(window).height()+$(window).scrollTop());var bottom_compare=((top+org_height)-(opts.edgeOffset+tip_h+8))<0;if(top_compare||(t_class=="_bottom"&&top_compare)||(t_class=="_top"&&!bottom_compare)){if(t_class=="_top"||t_class=="_bottom"){t_class="_top"}else{t_class=t_class+"_top"}arrow_top=tip_h;marg_top=Math.round(top-(tip_h+5+opts.edgeOffset))}else if(bottom_compare|(t_class=="_top"&&bottom_compare)||(t_class=="_bottom"&&!top_compare)){if(t_class=="_top"||t_class=="_bottom"){t_class="_bottom"}else{t_class=t_class+"_bottom"}arrow_top=-12;marg_top=Math.round(top+org_height+opts.edgeOffset)}if(t_class=="_right_top"||t_class=="_left_top"){marg_top=marg_top+5}else if(t_class=="_right_bottom"||t_class=="_left_bottom"){marg_top=marg_top-5}if(t_class=="_left_top"||t_class=="_left_bottom"){marg_left=marg_left+5}tiptip_arrow.css({"margin-left":arrow_left+"px","margin-top":arrow_top+"px"});tiptip_holder.css({"margin-left":marg_left+"px","margin-top":marg_top+"px"}).attr("class","tip"+t_class);if(timeout){clearTimeout(timeout)}timeout=setTimeout(function(){tiptip_holder.stop(true,true).fadeIn(opts.fadeIn)},opts.delay)}function deactive_tiptip(){opts.exit.call(this);if(timeout){clearTimeout(timeout)}tiptip_holder.fadeOut(opts.fadeOut)}}})}})(jQuery);

